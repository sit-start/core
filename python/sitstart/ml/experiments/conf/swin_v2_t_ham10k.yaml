# 87.4% val acc: https://wandb.ai/kevdale/swin_v2_t_ham10k/runs/65b69_00003
defaults:
  - _defaults_
  - trial/data: ham10k
  - trial/model: swin_v2_t
  - _self_
max_num_epochs: 200
param_space:
  train_loop_config:
    loss_fn: { _target_: ray.tune.grid_search, values: [focal] }
    gamma: { _target_: ray.tune.grid_search, values: [1.0] }
    weighted_loss: { _target_: ray.tune.grid_search, values: [1] }
    rebalance: { _target_: ray.tune.grid_search, values: [1] }
    lr: { _target_: ray.tune.grid_search, values: [3e-5] }
    dedupe: { _target_: ray.tune.grid_search, values: [1] }
trial:
  data:
    batch_size: 12
    module:
      rebalance: ${param_space.train_loop_config.rebalance}
      dedupe: ${param_space.train_loop_config.dedupe}
  loss_fn:
    _target_: sitstart.ml.losses.FocalLoss
    weight: ${if:${param_space.train_loop_config.weighted_loss},${trial.data.inv_class_freq},null}
    gamma: ${param_space.train_loop_config.gamma}
  optimizer:
    _partial_: true
    _target_: torch.optim.AdamW
    lr: ${param_space.train_loop_config.lr}
tune:
  scheduler:
    grace_period: ${max_num_epochs}
